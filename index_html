<!doctype html>
<html lang="ko">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>HEAL THE HEALTH, HEAL OURSELVES</title>
<style>
  :root{
    --blue:#0a84ff;
    --deep:#05334a;
    --muted:#6b8b93;
    --card:#ffffff;
  }
  *{box-sizing:border-box}
  html,body{height:100%;margin:0;font-family:"Noto Sans KR",system-ui,-apple-system,"Segoe UI",Roboto;}
  body{
    background: linear-gradient(180deg,#e8f6ff 0%, #ffffff 60%);
    color:var(--deep);
    -webkit-font-smoothing:antialiased;
  }

  /* particle bg canvas */
  #bgCanvas { position:fixed; left:0; top:0; width:100%; height:100%; z-index:0; pointer-events:none; }

  /* Header */
  header{
    position:fixed; left:0; right:0; top:0; height:92px;
    background:linear-gradient(90deg,var(--blue),#0d6ef1);
    color:white; display:flex; align-items:center; justify-content:space-between;
    padding:14px 22px; z-index:20; box-shadow:0 6px 20px rgba(10,60,90,0.12);
  }
  .brand { display:flex; gap:12px; align-items:center; }
  .logo { width:56px; height:56px; border-radius:10px; background:rgba(255,255,255,0.12); display:grid; place-items:center; }
  .title { font-weight:800; letter-spacing:0.4px; }
  .subtitle { font-size:12px; opacity:0.95 }

  /* layout */
  #container {
    max-width:1200px; margin:0 auto; padding:120px 20px 160px; position:relative; z-index:10;
    display:grid; grid-template-columns: 1fr 360px; gap:20px;
  }

  /* main sections */
  main { display:flex; flex-direction:column; gap:18px; min-height:0; }
  section.card {
    background:var(--card); border-radius:12px; padding:18px; box-shadow:0 8px 24px rgba(8,60,80,0.04);
  }
  h2{ margin:0 0 8px 0; color:var(--blue); font-size:18px }
  p{ margin:0; color:var(--deep); font-size:14px; line-height:1.6 }

  /* right column */
  aside { display:flex; flex-direction:column; gap:16px; position:sticky; top:110px; height:calc(100vh - 140px); overflow:auto; padding-bottom:10px; }

  /* small cards & controls */
  .small-card{ background:linear-gradient(180deg,#f7feff,#ffffff); padding:12px; border-radius:10px; border:1px solid rgba(10,120,190,0.04) }
  .gauge-canvas{ display:block; margin:6px auto; }

  input, select, textarea, button {
    font-size:14px;
  }
  input[type="text"], input[type="number"], select, textarea {
    width:100%; padding:8px 10px; border-radius:8px; border:1px solid #e6f3fb; background:#fbffff;
  }
  textarea{ min-height:70px; resize:vertical }
  button { background:var(--blue); color:white; border:none; border-radius:8px; padding:8px 12px; cursor:pointer; font-weight:700 }

  .btn-light { background:#eef9ff; color:var(--deep); border:1px solid #d8f1ff; }
  .muted { color:var(--muted); font-size:13px }

  .gallery { display:flex; gap:8px; flex-wrap:wrap; margin-top:10px }
  .gallery img { width:88px; height:88px; object-fit:cover; border-radius:8px; border:2px solid #e7fbff }

  .news-list { display:flex; flex-direction:column; gap:8px; margin-top:8px }
  .news-item { padding:10px; background:#f0fbff; border-radius:8px; border:1px solid #e1f6ff; font-size:13px }

  /* bottom dashboard */
  #bottomDash {
    position:fixed; left:0; right:0; bottom:0; height:120px;
    background:linear-gradient(180deg,#ffffff,#ecfbff); display:flex; align-items:center; justify-content:space-between;
    padding:12px 22px; gap:12px; z-index:30; border-top:1px solid rgba(8,80,90,0.04);
  }
  .dash-left { display:flex; gap:12px; align-items:center }
  .dash-aqi { font-size:20px; font-weight:800; color:var(--deep) }
  .dash-tip { font-size:13px; color:var(--muted) }

  /* responsive */
  @media (max-width:1000px){
    #container { grid-template-columns:1fr; padding:110px 14px 260px; gap:14px; }
    aside{ position:static; height:auto; top:auto }
  }
</style>
</head>
<body>

<canvas id="bgCanvas"></canvas>

<header>
  <div class="brand">
    <div class="logo" aria-hidden="true">
      <!-- simple svg -->
      <svg viewBox="0 0 48 48" width="36" height="36" xmlns="http://www.w3.org/2000/svg">
        <path d="M8 28c6-16 24-20 32-12-8 6-6 14-6 22-6 0-14-6-26-10z" fill="white" opacity="0.12"/>
        <path d="M18 34c-1-8 6-18 14-22" stroke="white" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round" fill="none"/>
      </svg>
    </div>
    <div>
      <div class="title">HEAL THE HEALTH, HEAL OURSELVES</div>
      <div class="subtitle">í™˜ê²½ ë°ì´í„° Ã— ê°œì¸ ê±´ê°• â€” ì‹¤ì‹œê°„ ê¶Œê³ ì™€ ì‹¤ì²œ</div>
    </div>
  </div>
  <div style="font-weight:700; color:rgba(255,255,255,0.95)">ê°„ë‹¨ Â· ê°€ë²¼ìš´ í™˜ê²½ ê±´ê°• ëŒ€ì‹œë³´ë“œ</div>
</header>

<div id="container">
  <main>
    <!-- Problem -->
    <section id="problem" class="card">
      <h2>ë¬¸ì œ ì¸ì‹</h2>
      <p>ëŒ€ê¸°ì˜¤ì—¼(PM2.5), ì˜¤ì¡´, ë¯¸ì„¸í”Œë¼ìŠ¤í‹± ë“±ì€ í˜¸í¡ê¸°ì™€ ì „ì‹  ê±´ê°•ì— ì˜í–¥ì„ ì£¼ë©°, ì·¨ì•½ê³„ì¸µì—ê²Œ ë” í° ìœ„í—˜ì„ ì•ˆê¹ë‹ˆë‹¤.</p>
    </section>

    <!-- Solution -->
    <section id="solution" class="card">
      <h2>í•´ê²° ì•„ì´ë””ì–´</h2>
      <p>ê°œì¸ì˜ ê±´ê°• ê¸°ë¡ê³¼ ì§€ì—­ í™˜ê²½ ë°ì´í„°ë¥¼ ì—°ë™í•˜ì—¬ ì‹¤ì‹œê°„ ê¶Œê³ ë¥¼ ì œê³µí•˜ê³ , ì‹œë¯¼ ì‹¤ì²œì„ ì´‰ì§„í•˜ëŠ” í”Œë«í¼ì„ ì œì•ˆí•©ë‹ˆë‹¤.</p>
      <div style="margin-top:12px">
        <canvas id="spark" width="360" height="80" style="display:block;margin:0 auto;border-radius:8px;"></canvas>
        <div class="muted" style="text-align:center; margin-top:6px">ì£¼ê°„ AQI íë¦„(ì‹œë®¬ë ˆì´ì…˜)</div>
      </div>
    </section>

    <!-- Approach -->
    <section id="approach" class="card">
      <h2>ë³´ê±´í•™ì  ì ‘ê·¼</h2>
      <p>í™˜ê²½ë³´ê±´í•™Â·ìƒë¦¬í•™Â·ê³µì¤‘ë³´ê±´í•™ì˜ ì§€ì‹ì„ ê²°í•©í•´ ì˜¤ì—¼ ë…¸ì¶œâ†’ìƒë¦¬ì  ì˜í–¥â†’ì˜ˆë°© ê¶Œê³ ë¡œ ì´ì–´ì§€ëŠ” ì²´ê³„ë¥¼ ì œê³µí•©ë‹ˆë‹¤.</p>
    </section>

    <!-- Participation -->
    <section id="participation" class="card">
      <h2>ì°¸ì—¬ ë° í–‰ë™</h2>
      <p>ê±´ê°•ì„ ê¸°ë¡í•˜ê³  ì‹¤ì²œì„ ì¸ì¦í•˜ì„¸ìš”. í€´ì¦ˆë¡œ ë‚˜ì˜ í™˜ê²½ ì§€ìˆ˜ë„ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>

      <!-- Health record -->
      <div style="margin-top:12px">
        <div style="font-weight:700">ë‚˜ì˜ ê±´ê°• ê¸°ë¡</div>
        <div style="margin-top:8px" class="muted">ì¦ìƒ/ì»¨ë””ì…˜ì„ ê°„ë‹¨íˆ ì ê³  ì €ì¥í•˜ë©´ ë¡œì»¬ì— ë³´ê´€ë©ë‹ˆë‹¤.</div>
        <div style="margin-top:8px">
          <input id="personName" type="text" placeholder="ì´ë¦„ (ì„ íƒ)">
          <input id="personAge" type="number" placeholder="ë‚˜ì´ (ì„ íƒ)" style="margin-top:8px;">
          <textarea id="personNote" placeholder="ì˜¤ëŠ˜ì˜ ì»¨ë””ì…˜ì´ë‚˜ ì¦ìƒ(ì˜ˆ: ê¸°ì¹¨, ë‘í†µ)"></textarea>
          <div style="display:flex; gap:8px; margin-top:8px">
            <button onclick="saveHealth()">ê¸°ë¡ ì €ì¥</button>
            <button class="btn-light" onclick="exportHealth()">CSV ë‚´ë³´ë‚´ê¸°</button>
          </div>
          <div id="healthRecords" style="margin-top:10px; font-size:13px; color:var(--muted)"></div>
        </div>
      </div>

      <!-- Gallery -->
      <div style="margin-top:14px">
        <div style="font-weight:700">ì‹¤ì²œ ì¸ì¦ ì—…ë¡œë“œ</div>
        <div class="muted" style="margin-top:6px">í…€ë¸”ëŸ¬ ì‚¬ìš©, ê³µê¸°ì •í™” í™œë™ ë“± ì‹¤ì²œ ì‚¬ì§„ì„ ì—…ë¡œë“œí•˜ì„¸ìš”.</div>
        <div style="display:flex; gap:8px; align-items:center; margin-top:8px">
          <input id="fileInput" type="file" accept="image/*">
          <button class="btn-light" onclick="uploadImage()">ì—…ë¡œë“œ</button>
        </div>
        <div class="gallery" id="gallery"></div>
      </div>

      <!-- Quiz -->
      <div style="margin-top:14px">
        <div style="font-weight:700">ê°„ë‹¨ í€´ì¦ˆ â€” í™˜ê²½ ì§€ìˆ˜</div>
        <div class="muted" style="margin-top:6px">ëª‡ ê°€ì§€ ì§ˆë¬¸ìœ¼ë¡œ í™˜ê²½ ì¹œí™”ë„ë¥¼ ê³„ì‚°í•©ë‹ˆë‹¤.</div>
        <div style="margin-top:8px">
          <label>1) ì£¼ êµí†µìˆ˜ë‹¨</label>
          <select id="q1"><option value="2">ëŒ€ì¤‘êµí†µ/ë„ë³´</option><option value="0">ìê°€ìš©</option></select>
          <label style="margin-top:6px">2) ì¼íšŒìš©í’ˆ ì‚¬ìš©</label>
          <select id="q2"><option value="2">ì¤„ì´ê³  ìˆìŒ</option><option value="1">ê°€ë” ì¤„ì„</option><option value="0">ì¤„ì´ì§€ ì•ŠìŒ</option></select>
          <label style="margin-top:6px">3) í™˜ê²½ ì •ë³´ í™•ì¸</label>
          <select id="q3"><option value="2">ìì£¼</option><option value="0">ê±°ì˜ ì•ˆí•¨</option></select>
          <div style="display:flex; gap:8px; margin-top:8px">
            <button onclick="calcScore()">ê²°ê³¼ ë³´ê¸°</button>
            <button class="btn-light" onclick="resetScore()">ë¦¬ì…‹</button>
          </div>
          <div id="scoreResult" style="margin-top:8px; font-weight:700; color:var(--deep)"></div>
        </div>
      </div>
    </section>

    <!-- News -->
    <section id="news" class="card">
      <h2>ë‰´ìŠ¤ ìš”ì•½</h2>
      <div class="news-list" id="newsList">
        <div class="news-item">ğŸŒ WHO: ëŒ€ê¸°ì˜¤ì—¼ ê´€ë ¨ ê±´ê°• ì˜í–¥ ë¦¬í¬íŠ¸(ìƒ˜í”Œ)</div>
        <div class="news-item">ğŸ’§ ë¯¸ì„¸í”Œë¼ìŠ¤í‹±, í•´ì–‘ìƒë¬¼ ì¶•ì  ë³´ê³ (ìƒ˜í”Œ)</div>
        <div class="news-item">ğŸŒ¿ ë„ì‹œ ë…¹ì§€ í™•ëŒ€ê°€ ì‹¬ë¦¬ê±´ê°• ê°œì„ ì— ê¸°ì—¬(ìƒ˜í”Œ)</div>
      </div>
    </section>
  </main>

  <aside>
    <div class="small-card">
      <div style="font-weight:700; font-size:15px">ì‹¤ì‹œê°„ í™˜ê²½ ëŒ€ì‹œë³´ë“œ</div>
      <canvas id="gaugeCanvas" width="120" height="120" class="gauge-canvas"></canvas>
      <div style="text-align:center; margin-top:6px">
        <div class="dash-aqi" id="aqiNumber">â€”</div>
        <div class="dash-tip" id="aqiLabel">ë°ì´í„° ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘</div>
      </div>
      <div style="display:flex; gap:8px; justify-content:center; margin-top:8px">
        <button class="btn-light" onclick="refreshData()">ìƒˆë¡œê³ ì¹¨</button>
        <button class="btn" onclick="shareSummary()">ê³µìœ </button>
      </div>
    </div>

    <div class="small-card">
      <div style="font-weight:700">ë‰´ìŠ¤ í•˜ì´ë¼ì´íŠ¸</div>
      <div class="muted" style="margin-top:8px" id="miniNews">â€¢ ì§€ì—­ ê³µê¸°ì§ˆ ëª¨ë‹ˆí„°ë§(ìƒ˜í”Œ)</div>
    </div>

    <div class="small-card">
      <div style="font-weight:700">í›„ì›</div>
      <div class="muted" style="margin-top:8px">í”„ë¡œì íŠ¸ ìš´ì˜ì„ ìœ„í•œ í›„ì›</div>
      <div style="display:flex; gap:8px; margin-top:8px; justify-content:center">
        <button class="btn" onclick="openDonate(3000)">â‚©3,000</button>
        <button class="btn" onclick="openDonate(10000)">â‚©10,000</button>
      </div>
      <div style="margin-top:8px; text-align:center">
        <button class="btn-light" onclick="openDonate()">ì§ì ‘ ì…ë ¥</button>
      </div>
      <div id="donationMsg" class="muted" style="margin-top:8px"></div>
    </div>
  </aside>
</div>

<!-- Donate modal -->
<div id="donModal" style="display:none; position:fixed; inset:0; background:rgba(0,0,0,0.45); z-index:60; align-items:center; justify-content:center;">
  <div style="background:white; padding:18px; border-radius:10px; width:320px;">
    <div style="font-weight:800; color:var(--blue); margin-bottom:6px">í”„ë¡œì íŠ¸ í›„ì›</div>
    <input id="donAmount" type="number" placeholder="ê¸ˆì•¡ (ì›)" style="width:100%; padding:8px; border-radius:8px; border:1px solid #eef6ff">
    <div style="display:flex; gap:8px; margin-top:10px">
      <button class="btn" onclick="submitDonation()">í›„ì›í•˜ê¸°</button>
      <button class="btn-light" onclick="closeDonate()">ë‹«ê¸°</button>
    </div>
    <div id="donInfo" class="muted" style="margin-top:8px"></div>
  </div>
</div>

<!-- bottom dashboard -->
<div id="bottomDash">
  <div class="dash-left">
    <div class="muted">ìœ„ì¹˜</div>
    <div style="font-weight:800">ì„œìš¸ (ìƒ˜í”Œ)</div>
  </div>
  <div style="text-align:center">
    <div class="muted">ì˜¤ëŠ˜ì˜ ëŒ€ê¸°ì§ˆ (AQI)</div>
    <div class="dash-aqi" id="bottomAQI">â€”</div>
  </div>
  <div style="text-align:right">
    <div class="muted">ê¶Œê³ </div>
    <div class="dash-tip" id="bottomTip">â€”</div>
  </div>
</div>

<script>
/* -------------------------
   Particle background (light)
   ------------------------- */
const bgCanvas = document.getElementById('bgCanvas');
const bgCtx = bgCanvas.getContext('2d');
function resizeBg(){
  bgCanvas.width = innerWidth;
  bgCanvas.height = innerHeight;
}
window.addEventListener('resize', resizeBg);
resizeBg();

const particles = [];
for(let i=0;i<60;i++){
  particles.push({
    x: Math.random()*bgCanvas.width,
    y: Math.random()*bgCanvas.height,
    r: 0.6 + Math.random()*2.2,
    vx: (Math.random()-0.5)*0.3,
    vy: (Math.random()-0.5)*0.3,
    a: 0.05 + Math.random()*0.16
  });
}
function anim(){
  bgCtx.clearRect(0,0,bgCanvas.width,bgCanvas.height);
  for(const p of particles){
    p.x += p.vx; p.y += p.vy;
    if(p.x < -10) p.x = bgCanvas.width+10;
    if(p.x > bgCanvas.width+10) p.x = -10;
    if(p.y < -10) p.y = bgCanvas.height+10;
    if(p.y > bgCanvas.height+10) p.y = -10;
    bgCtx.beginPath();
    bgCtx.fillStyle = 'rgba(10,132,255,'+p.a+')';
    bgCtx.arc(p.x, p.y, p.r, 0, Math.PI*2);
    bgCtx.fill();
  }
  requestAnimationFrame(anim);
}
anim();

/* -------------------------
   Sparkline (simple)
   ------------------------- */
const spark = document.getElementById('spark');
const sCtx = spark.getContext('2d');
let sparkData = [55,60,48,70,65,50,45];
function drawSpark(){
  const w = spark.width, h = spark.height;
  sCtx.clearRect(0,0,w,h);
  sCtx.fillStyle = 'rgba(10,132,255,0.04)';
  sCtx.fillRect(0,0,w,h);
  const max = Math.max(...sparkData)*1.1;
  const min = Math.min(...sparkData)*0.9;
  sCtx.beginPath();
  for(let i=0;i<sparkData.length;i++){
    const x = 8 + i*(w-16)/(sparkData.length-1);
    const y = h - 8 - ((sparkData[i]-min)/(max-min))*(h-16);
    if(i===0) sCtx.moveTo(x,y); else sCtx.lineTo(x,y);
  }
  sCtx.strokeStyle = '#0a84ff'; sCtx.lineWidth = 2; sCtx.stroke();
  // fill
  sCtx.lineTo(w-8,h-8); sCtx.lineTo(8,h-8); sCtx.closePath();
  const g = sCtx.createLinearGradient(0,0,0,h);
  g.addColorStop(0,'rgba(10,132,255,0.12)'); g.addColorStop(1,'rgba(10,132,255,0.02)');
  sCtx.fillStyle = g; sCtx.fill();
}
drawSpark();

/* -------------------------
   Gauge (simple arc)
   ------------------------- */
const gauge = document.getElementById('gaugeCanvas');
const gCtx = gauge.getContext('2d');
function drawGauge(aqi){
  const w = gauge.width, h = gauge.height;
  gCtx.clearRect(0,0,w,h);
  const cx = w/2, cy = h/2, r = Math.min(w,h)/2 - 10;
  // bg arc
  gCtx.beginPath(); gCtx.lineWidth = 10; gCtx.strokeStyle = '#e6f7ff';
  gCtx.arc(cx,cy,r,Math.PI*0.75,Math.PI*0.25,false); gCtx.stroke();
  // value
  const max = 300; const pct = Math.max(0, Math.min(max, aqi))/max;
  const end = Math.PI*0.75 + (Math.PI*1.5)*pct;
  let color = '#1aa38f'; if(aqi>100) color = '#f9c74f'; if(aqi>200) color = '#f29c9c';
  gCtx.beginPath(); gCtx.lineWidth = 10; gCtx.lineCap='round'; gCtx.strokeStyle = color;
  gCtx.arc(cx,cy,r,Math.PI*0.75,end,false); gCtx.stroke();
  // center text
  gCtx.fillStyle = '#05334a'; gCtx.font = '700 16px Noto Sans KR, sans-serif';
  gCtx.textAlign = 'center'; gCtx.fillText(aqi, cx, cy+6);
}

/* -------------------------
   Simulate/refresh data
   ------------------------- */
function getLabel(aqi){
  if(aqi<=50) return {t:'ì¢‹ìŒ', tip:'ì•¼ì™¸ í™œë™ ê¶Œì¥'};
  if(aqi<=100) return {t:'ë³´í†µ', tip:'ì¥ì‹œê°„ ê²©ë ¬ í™œë™ ìì œ'};
  if(aqi<=200) return {t:'ë‚˜ì¨', tip:'ê¸°ì €ì§ˆí™˜ì ì£¼ì˜'};
  return {t:'ë§¤ìš° ë‚˜ì¨', tip:'ëª¨ë“  ì‚¬ëŒ ì‹¤ì™¸í™œë™ ìì œ'};
}
function refreshData(){
  const aqi = Math.round(25 + Math.random()*170);
  const temp = Math.round(6 + Math.random()*24);
  // update sparkline
  sparkData.shift(); sparkData.push(aqi); drawSpark();
  // gauge
  drawGauge(aqi);
  const lbl = getLabel(aqi);
  document.getElementById('aqiNumber').innerText = aqi;
  document.getElementById('aqiLabel').innerText = lbl.t + ' Â· ' + lbl.tip;
  document.getElementById('bottomAQI').innerText = aqi;
  document.getElementById('bottomTip').innerText = lbl.tip;
  document.getElementById('miniNews').innerText = 'â€¢ ì‹¤ì‹œê°„: AQI ' + aqi + ' ('+lbl.t+')';
}
refreshData();
setInterval(refreshData, 12000);

/* -------------------------
   Health records (localStorage)
   ------------------------- */
const REC_KEY = 'heal_health_v1';
function saveHealth(){
  const name = document.getElementById('personName').value.trim() || 'ìµëª…';
  const age = document.getElementById('personAge').value.trim() || '';
  const note = document.getElementById('personNote').value.trim();
  if(!note){ alert('ê¸°ë¡ ë‚´ìš©ì„ ì…ë ¥í•˜ì„¸ìš”'); return; }
  const arr = JSON.parse(localStorage.getItem(REC_KEY) || '[]');
  arr.unshift({name, age, note, time: new Date().toISOString()});
  localStorage.setItem(REC_KEY, JSON.stringify(arr));
  document.getElementById('personNote').value = '';
  renderRecords();
  // give feedback
  feedbackFor(note);
}
function renderRecords(){
  const arr = JSON.parse(localStorage.getItem(REC_KEY) || '[]');
  const el = document.getElementById('healthRecords');
  if(arr.length===0){ el.innerHTML = '<div class="muted">ì €ì¥ëœ ê¸°ë¡ì´ ì—†ìŠµë‹ˆë‹¤.</div>'; return; }
  el.innerHTML = arr.slice(0,6).map(it => {
    const t = new Date(it.time).toLocaleString();
    return `<div style="padding:8px 0; border-bottom:1px dashed #eef9ff">
      <div style="font-weight:700">${escapeHtml(it.name)}${it.age? ' Â· '+escapeHtml(it.age)+'ì„¸':''} <span style="font-size:12px;color:var(--muted)">${t}</span></div>
      <div style="color:var(--muted); font-size:13px">${escapeHtml(it.note)}</div>
    </div>`;
  }).join('');
}
function feedbackFor(note){
  const n = note.toLowerCase();
  let fb = 'ê¸°ë¡ë˜ì—ˆìŠµë‹ˆë‹¤. ìƒíƒœë¥¼ ê´€ì°°í•˜ì„¸ìš”.';
  if(n.includes('ë‘í†µ') || n.includes('ì–´ì§€')) fb = 'ë‘í†µ/ì–´ì§€ëŸ¼: íœ´ì‹Â·ìˆ˜ë¶„ ê¶Œì¥. ì¦ìƒ ì§€ì† ì‹œ ì§„ë£Œ ê³ ë ¤.';
  else if(n.includes('ê¸°ì¹¨') || n.includes('í˜¸í¡') || n.includes('ìˆ¨')) fb = 'í˜¸í¡ê¸° ì¦ìƒ: ì™¸ì¶œ ì‹œ ë§ˆìŠ¤í¬ ì°©ìš© ê¶Œì¥. ì•…í™” ì‹œ ì˜ë£Œê¸°ê´€ ë°©ë¬¸.';
  else if(n.includes('í”¼ë¡œ')) fb = 'í”¼ë¡œ: ì¶©ë¶„í•œ ìˆ˜ë©´ê³¼ íœ´ì‹ ê¶Œì¥.';
  alert('í”¼ë“œë°±:\n' + fb);
}
function exportHealth(){
  const arr = JSON.parse(localStorage.getItem(REC_KEY) || '[]');
  if(arr.length===0){ alert('ë‚´ë³´ë‚¼ ê¸°ë¡ì´ ì—†ìŠµë‹ˆë‹¤.'); return; }
  const rows = arr.map(r => [r.name, r.age, r.time, r.note.replace(/"/g,'""')].map(x=>'"'+x+'"').join(','));
  const csv = 'ì´ë¦„,ë‚˜ì´,ì‹œê°„,ë‚´ìš©\n' + rows.join('\n');
  const blob = new Blob([csv], {type:'text/csv;charset=utf-8;'}); const url = URL.createObjectURL(blob);
  const a = document.createElement('a'); a.href = url; a.download = 'health_records.csv'; a.click(); URL.revokeObjectURL(url);
}
renderRecords();

/* -------------------------
   Gallery (localStorage base64)
   ------------------------- */
const GAL_KEY = 'heal_gallery_v1';
function uploadImage(){
  const inp = document.getElementById('fileInput');
  const f = inp.files[0];
  if(!f){ alert('ì´ë¯¸ì§€ë¥¼ ì„ íƒí•˜ì„¸ìš”'); return; }
  const reader = new FileReader();
  reader.onload = function(e){
    const arr = JSON.parse(localStorage.getItem(GAL_KEY) || '[]');
    arr.unshift({src:e.target.result, time: new Date().toISOString()});
    localStorage.setItem(GAL_KEY, JSON.stringify(arr));
    renderGallery();
    inp.value = '';
    alert('ì—…ë¡œë“œ ì™„ë£Œ');
  };
  reader.readAsDataURL(f);
}
function renderGallery(){
  const arr = JSON.parse(localStorage.getItem(GAL_KEY) || '[]');
  const el = document.getElementById('gallery'); el.innerHTML = '';
  arr.slice(0,12).forEach(item => {
    const img = document.createElement('img'); img.src = item.src; img.title = new Date(item.time).toLocaleString();
    el.appendChild(img);
  });
}
renderGallery();

/* -------------------------
   Donations (local simulated)
   ------------------------- */
const DON_KEY = 'heal_don_v1';
function openDonate(amount){
  document.getElementById('donModal').style.display = 'flex';
  if(amount) document.getElementById('donAmount').value = amount;
}
function closeDonate(){ document.getElementById('donModal').style.display = 'none'; }
function submitDonation(){
  const v = Number(document.getElementById('donAmount').value);
  if(!v || v<=0){ alert('ìœ íš¨í•œ ê¸ˆì•¡ì„ ì…ë ¥í•˜ì„¸ìš”'); return; }
  const arr = JSON.parse(localStorage.getItem(DON_KEY) || '[]');
  arr.unshift({amount:v, time:new Date().toISOString()});
  localStorage.setItem(DON_KEY, JSON.stringify(arr));
  document.getElementById('donationMsg').innerText = 'ìµœê·¼ í›„ì› í•©ê³„: â‚©' + arr.slice(0,10).reduce((s,i)=>s+i.amount,0);
  document.getElementById('donInfo').innerText = 'ê°ì‚¬í•©ë‹ˆë‹¤! â‚©' + v + ' í›„ì›ë˜ì—ˆìŠµë‹ˆë‹¤. (ë°ëª¨)';
  setTimeout(()=>{ closeDonate(); document.getElementById('donInfo').innerText=''; }, 1200);
}

/* -------------------------
   Quiz
   ------------------------- */
function calcScore(){
  const s = Number(document.getElementById('q1').value) + Number(document.getElementById('q2').value) + Number(document.getElementById('q3').value);
  const pct = Math.round((s / 6) * 100);
  const el = document.getElementById('scoreResult');
  if(pct >= 80) el.innerText = `ğŸŒ¿ í™˜ê²½ì§€ìˆ˜: ${pct} â€” ë§¤ìš° ìš°ìˆ˜í•©ë‹ˆë‹¤!`;
  else if(pct >= 50) el.innerText = `ğŸ™‚ í™˜ê²½ì§€ìˆ˜: ${pct} â€” ì¢‹ì€ í¸ì…ë‹ˆë‹¤.`;
  else el.innerText = `ğŸ”° í™˜ê²½ì§€ìˆ˜: ${pct} â€” ì‹œì‘í•´ë³´ì„¸ìš”!`;
  localStorage.setItem('heal_env_score', JSON.stringify({score:pct, time:new Date().toISOString()}));
}
function resetScore(){ document.getElementById('scoreResult').innerText = ''; document.getElementById('q1').value='2'; document.getElementById('q2').value='2'; document.getElementById('q3').value='2'; }

/* -------------------------
   Share summary
   ------------------------- */
function shareSummary(){
  const aqi = document.getElementById('bottomAQI').innerText || 'â€”';
  const s = `ì˜¤ëŠ˜ì˜ AQI: ${aqi} â€” HEAL THE HEALTH í”„ë¡œì íŠ¸`;
  if(navigator.share){ navigator.share({title:'í™˜ê²½ê±´ê°• ìš”ì•½', text:s}).catch(()=>navigator.clipboard.writeText(s)); }
  else { navigator.clipboard.writeText(s); alert('ìš”ì•½ì´ í´ë¦½ë³´ë“œì— ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤.'); }
}

/* -------------------------
   small helpers
   ------------------------- */
function escapeHtml(s){ return String(s).replace(/[&<>"']/g, c=>({ '&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;' }[c])); }

/* -------------------------
   initial
   ------------------------- */
document.addEventListener('DOMContentLoaded', ()=>{
  // initial values already set by refreshData()
  document.getElementById('donationMsg').innerText = '';
  const arr = JSON.parse(localStorage.getItem(DON_KEY) || '[]');
  if(arr.length>0) document.getElementById('donationMsg').innerText = 'ìµœê·¼ í›„ì› í•©ê³„: â‚©' + arr.slice(0,10).reduce((s,i)=>s+i.amount,0);
});
</script>
</body>
</html>
